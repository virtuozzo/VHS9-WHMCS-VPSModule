/*
 * JSUnzip
 *
 * Copyright (c) 2011 by Erik Moller
 * All Rights Reserved
 *
 * This software is provided 'as-is', without any express
 * or implied warranty.  In no event will the authors be
 * held liable for any damages arising from the use of
 * this software.
 *
 * Permission is granted to anyone to use this software
 * for any purpose, including commercial applications,
 * and to alter it and redistribute it freely, subject to
 * the following restrictions:
 *
 * 1. The origin of this software must not be
 *    misrepresented; you must not claim that you
 *    wrote the original software. If you use this
 *    software in a product, an acknowledgment in
 *    the product documentation would be appreciated
 *    but is not required.
 *
 * 2. Altered source versions must be plainly marked
 *    as such, and must not be misrepresented as
 *    being the original software.
 *
 * 3. This notice may not be removed or altered from
 *    any source distribution.
 */
function JSUnzip(){this.getInt=function(e,t){switch(t){case 4:return(this.data.charCodeAt(e+3)&255)<<24|(this.data.charCodeAt(e+2)&255)<<16|(this.data.charCodeAt(e+1)&255)<<8|this.data.charCodeAt(e+0)&255;case 2:return(this.data.charCodeAt(e+1)&255)<<8|this.data.charCodeAt(e+0)&255;default:return this.data.charCodeAt(e)&255}},this.getDOSDate=function(e,t){var n=e&31,r=(e>>5&15)-1,i=1980+(e>>9&127),s=(t&31)*2,o=t>>5&63;return hour=t>>11&31,new Date(i,r,n,hour,o,s)},this.open=function(e){this.data=e,this.files=[];if(this.data.length<22)return{status:!1,error:"Invalid data"};var t=this.data.length-22;while(t>=0&&this.getInt(t,4)!=101010256)--t;if(t<0)return{status:!1,error:"Invalid data"};if(this.getInt(t+4,2)!=0||this.getInt(t+6,2)!=0)return{status:!1,error:"No multidisk support"};var n=this.getInt(t+8,2),r=this.getInt(t+16,4),i=this.getInt(t+20,2);this.comment=this.data.slice(t+22,t+22+i);var s=r;for(var o=0;o<n;++o){if(this.getInt(s+0,4)!=33639248)return{status:!1,error:"Invalid data"};if(this.getInt(s+6,2)>20)return{status:!1,error:"Unsupported version"};if(this.getInt(s+8,2)&1)return{status:!1,error:"Encryption not implemented"};var u=this.getInt(s+10,2);if(u!=0&&u!=8)return{status:!1,error:"Unsupported compression method"};var a=this.getInt(s+12,2),f=this.getInt(s+14,2),l=this.getDOSDate(f,a),c=this.getInt(s+16,4),h=this.getInt(s+20,4),p=this.getInt(s+24,4),d=this.getInt(s+28,2),v=this.getInt(s+30,2),m=this.getInt(s+32,2),g=this.getInt(s+42,4),y=this.data.slice(s+46,s+46+d),b=this.data.slice(s+46+d+v,s+46+d+v+m);if(this.getInt(g+0,4)!=67324752)return{status:!1,error:"Invalid data"};var w=this.getInt(g+26,2),E=this.getInt(g+28,2),S=g+30+w+E;this.files[y]={fileComment:b,compressionMethod:u,compressedSize:h,uncompressedSize:p,localFileContent:S,lastModifiedDate:l},s+=46+d+v+m}return{status:!0}},this.read=function(e){var t=this.files[e];if(t){if(t.compressionMethod==8){tinf||(tinf=new TINF,tinf.init());var n=tinf.uncompress(this.data,t.localFileContent);return n.status==tinf.OK?{status:!0,data:n.data}:{status:!1,error:n.error}}return{status:!0,data:this.data.slice(t.localFileContent,t.localFileContent+t.uncompressedSize)}}return{status:!1,error:"File '"+e+"' doesn't exist in zip"}}}function TINF(){function e(e,t,n,r,i){var s=0;while(t<24)n|=(e[r++]&255)<<t,t+=8;return s=n&65535>>16-i,n>>=i,t-=i,[t,n,r,s]}this.OK=0,this.DATA_ERROR=-3,this.WINDOW_SIZE=32768,this.TREE=function(){this.table=new Array(16),this.trans=new Array(288)},this.DATA=function(e){this.source="",this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=[],this.history=[],this.ltree=new e.TREE,this.dtree=new e.TREE},this.sltree=new this.TREE,this.sdtree=new this.TREE,this.length_bits=new Array(30),this.length_base=new Array(30),this.dist_bits=new Array(30),this.dist_base=new Array(30),this.clcidx=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],this.build_bits_base=function(e,t,n,r){var i,s;for(i=0;i<n;++i)e[i]=0;for(i=0;i<30-n;++i)e[i+n]=Math.floor(i/n);for(s=r,i=0;i<30;++i)t[i]=s,s+=1<<e[i]},this.build_fixed_trees=function(e,t){var n;for(n=0;n<7;++n)e.table[n]=0;e.table[7]=24,e.table[8]=152,e.table[9]=112;for(n=0;n<24;++n)e.trans[n]=256+n;for(n=0;n<144;++n)e.trans[24+n]=n;for(n=0;n<8;++n)e.trans[168+n]=280+n;for(n=0;n<112;++n)e.trans[176+n]=144+n;for(n=0;n<5;++n)t.table[n]=0;t.table[5]=32;for(n=0;n<32;++n)t.trans[n]=n},this.build_tree=function(e,t,n,r){var i=new Array(16),s,o;for(s=0;s<16;++s)e.table[s]=0;for(s=0;s<r;++s)e.table[t[n+s]]++;e.table[0]=0;for(o=0,s=0;s<16;++s)i[s]=o,o+=e.table[s];for(s=0;s<r;++s)t[n+s]&&(e.trans[i[t[n+s]]++]=s)},this.getbit=function(e){var t;return e.bitcount--||(e.tag=e.source[e.sourceIndex++]&255,e.bitcount=7),t=e.tag&1,e.tag>>=1,t},this.read_bits=function(t,n,r){if(!n)return r;var i=e(t.source,t.bitcount,t.tag,t.sourceIndex,n);return t.bitcount=i[0],t.tag=i[1],t.sourceIndex=i[2],i[3]+r},this.decode_symbol=function(e,t){while(e.bitcount<16)e.tag=e.tag|(e.source[e.sourceIndex++]&255)<<e.bitcount,e.bitcount+=8;var n=0,r=0,i=0;do r=2*r+((e.tag&1<<i)>>i),++i,n+=t.table[i],r-=t.table[i];while(r>=0);return e.tag>>=i,e.bitcount-=i,t.trans[n+r]},this.decode_trees=function(e,t,n){var r=new this.TREE,i=new Array(320),s,o,u,a,f,l;s=this.read_bits(e,5,257),o=this.read_bits(e,5,1),u=this.read_bits(e,4,4);for(a=0;a<19;++a)i[a]=0;for(a=0;a<u;++a){var c=this.read_bits(e,3,0);i[this.clcidx[a]]=c}this.build_tree(r,i,0,19);for(f=0;f<s+o;){var h=this.decode_symbol(e,r);switch(h){case 16:var p=i[f-1];for(l=this.read_bits(e,2,3);l;--l)i[f++]=p;break;case 17:for(l=this.read_bits(e,3,3);l;--l)i[f++]=0;break;case 18:for(l=this.read_bits(e,7,11);l;--l)i[f++]=0;break;default:i[f++]=h}}this.build_tree(t,i,0,s),this.build_tree(n,i,s,o)},this.inflate_block_data=function(e,t,n){var r=e.dest,i=r.length;for(;;){var s=this.decode_symbol(e,t);if(s==256)return this.OK;if(s<256)r[i++]=s,e.history.push(s);else{var o,u,a,f;s-=257,o=this.read_bits(e,this.length_bits[s],this.length_base[s]),u=this.decode_symbol(e,n),a=e.history.length-this.read_bits(e,this.dist_bits[u],this.dist_base[u]);if(a<0)throw"Invalid zlib offset "+a;for(f=a;f<a+o;++f)r[i++]=e.history[f],e.history.push(e.history[f])}}},this.inflate_uncompressed_block=function(e){var t,n,r;if(e.bitcount>7){var i=Math.floor(e.bitcount/8);e.sourceIndex-=i,e.bitcount=0,e.tag=0}t=e.source[e.sourceIndex+1],t=256*t+e.source[e.sourceIndex],n=e.source[e.sourceIndex+3],n=256*n+e.source[e.sourceIndex+2];if(t!=(~n&65535))return this.DATA_ERROR;e.sourceIndex+=4;for(r=t;r;--r)e.history.push(e.source[e.sourceIndex]),e.dest[e.dest.length]=e.source[e.sourceIndex++];return e.bitcount=0,this.OK},this.inflate_fixed_block=function(e){return this.inflate_block_data(e,this.sltree,this.sdtree)},this.inflate_dynamic_block=function(e){return this.decode_trees(e,e.ltree,e.dtree),this.inflate_block_data(e,e.ltree,e.dtree)},this.init=function(){this.build_fixed_trees(this.sltree,this.sdtree),this.build_bits_base(this.length_bits,this.length_base,4,3),this.build_bits_base(this.dist_bits,this.dist_base,2,1),this.length_bits[28]=0,this.length_base[28]=258,this.reset()},this.reset=function(){this.d=new this.DATA(this),delete this.header},this.uncompress=function(e,t){var n=this.d,r;n.source=e,n.sourceIndex=t,n.bitcount=0,n.dest=[],typeof this.header=="undefined"&&(this.header=this.read_bits(n,16,0));var i=0;do{var s,o;r=this.getbit(n),s=this.read_bits(n,2,0);switch(s){case 0:o=this.inflate_uncompressed_block(n);break;case 1:o=this.inflate_fixed_block(n);break;case 2:o=this.inflate_dynamic_block(n);break;default:return{status:this.DATA_ERROR}}if(o!=this.OK)return{status:this.DATA_ERROR};i++}while(!r&&n.sourceIndex<n.source.length);return n.history=n.history.slice(-this.WINDOW_SIZE),{status:this.OK,data:n.dest}}}var tinf;"use strict";